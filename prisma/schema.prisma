generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Member {
  id                     Int             @id @default(autoincrement())
  email                  String
  name                   String
  password               String
  role                   Role
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  deletedAt              DateTime?
  clients                Client[]        @relation("CareWorkerClients")
  journals               Journal[]       @relation("CareWorkerJournals")
  managedBySocialWorker  ManageMember?   @relation("CareWorkerToSocialWorker")
  managedCareWorkers     ManageMember[]  @relation("SocialWorkerToCareWorkers")
  notifications          Notification[]
  reportsAsCareWorker    Report[]        @relation("Reports_CareWorker")
  reportsAsCSocialWorker Report[]        @relation("Reports_SocialWorker")
  socialAccounts         SocialAccount[]
  works                  Work[]
}

model ManageMember {
  id             Int    @id
  socialWorkerId Int
  careWorker     Member @relation("CareWorkerToSocialWorker", fields: [id], references: [id])
  socialWorker   Member @relation("SocialWorkerToCareWorkers", fields: [socialWorkerId], references: [id])
}

model SocialAccount {
  id         Int            @id @default(autoincrement())
  memberId   Int
  platform   SocialPlatform
  platformId String
  createdAt  DateTime       @default(now())
  member     Member         @relation(fields: [memberId], references: [id])

  @@unique([platform, platformId])
}

model Client {
  id              Int       @id @default(autoincrement())
  name            String
  birthDate       DateTime
  gender          String
  address         String?
  contact         String?
  guardianContact String?
  careWorkerId    Int
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  careWorker      Member    @relation("CareWorkerClients", fields: [careWorkerId], references: [id], onDelete: Cascade)
  journals        Journal[]
}

model Work {
  id        Int         @id @default(autoincrement())
  memberId  Int
  date      DateTime
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  member    Member      @relation(fields: [memberId], references: [id])
  events    WorkEvent[]

  @@unique([memberId, date])
}

model WorkEvent {
  id        Int           @id @default(autoincrement())
  workId    Int
  type      WorkEventType
  time      DateTime
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  work      Work          @relation(fields: [workId], references: [id])

  @@index([workId])
}

model Journal {
  id              Int      @id @default(autoincrement())
  careWorkerId    Int
  clientId        Int
  rawAudioUrl     String
  transcript      String
  summary         String?
  recommendations String?
  opinion         String?
  result          String?
  note            String?
  exportedPdf     String?
  exportedDocx    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  issues          String?  @db.VarChar
  careWorker      Member   @relation("CareWorkerJournals", fields: [careWorkerId], references: [id])
  client          Client   @relation(fields: [clientId], references: [id])
}

model Report {
  id             Int      @id @default(autoincrement())
  socialWorkerId Int
  periodStart    DateTime
  periodEnd      DateTime
  careWorkerId   Int
  content        String
  exported       String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  careWorker     Member   @relation("Reports_CareWorker", fields: [careWorkerId], references: [id])
  socialWorker   Member   @relation("Reports_SocialWorker", fields: [socialWorkerId], references: [id])
}

model Notification {
  id        Int      @id @default(autoincrement())
  memberId  Int
  title     String
  content   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  member    Member   @relation(fields: [memberId], references: [id])
}

enum Role {
  careWorker
  socialWorker
}

enum SocialPlatform {
  KAKAO
  GOOGLE
  NAVER
}

enum WorkEventType {
  CLOCK_IN
  CLOCK_OUT
}
